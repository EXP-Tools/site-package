(function() {
    var t, s = {};
    (t = new plupload.Uploader({
        runtimes: "html5, flash",
        browse_button: "pickfile",
        container: "file-select",
        drop_element: "file-select",
        file_data_name: "image",
        multi_selection: !1,
        url: WWW_URL + "ajax",
        flash_swf_url: WWW_PUBLIC + "tool/Moxie.swf",
        filters: {
            mime_types: [{
                title: "image files",
                extensions: "jpg,png,gif,jpeg"
            }],
            max_file_size: "8mb"
        },
        resize: {
            width: 1200,
            height: 5e3,
            crop: !1,
            quality: 60,
            preserve_headers: !1
        }
    })).bind("Error", function(e, i) {
        e.refresh(),
        $(".btn-list").hide(),
        tips_error(i.message)
    }),
    t.bind("FilesAdded", function(e, i) {
        t.start(),
        e.refresh()
    }),
    t.bind("BeforeUpload", function(e, i) {
        $.each($("form").serializeArray(), function() {
            s[this.name] = this.value
        }),
        e.setOption("multipart_params", s),
        tips_loading()
    }),
    t.bind("FileUploaded", function(e, i, t) {
        tips_clear(),
        data = JSON.parse(t.response),
        1 == data.status ? ($("#tool-result").html(data.data).show(),
        $(".btn-list").show()) : ($(".btn-list").hide(),
        tips_error(data.info))
    }),
    t.init()
}
).call(this);
